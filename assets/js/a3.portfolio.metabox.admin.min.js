jQuery(function(t){t(document).on("change",".a3-portfolio-meta-tag-link",function(){"0"!=t(this).val()?t(this).parents("tr").siblings("tr").find(".portfolio_meta_link_url_row").slideUp():t(this).parents("tr").siblings("tr").find(".portfolio_meta_link_url_row").slideDown()});var o,e=t("#portfolio_image_gallery"),a=t("#portfolio_images_container ul.portfolio_images");t(".add_portfolio_images").on("click","a",function(i){var r=t(this),n=e.val();return i.preventDefault(),o?void o.open():(o=wp.media.frames.portfolio_gallery=wp.media({title:r.data("choose"),button:{text:r.data("update")},states:[new wp.media.controller.Library({title:r.data("choose"),filterable:"all",multiple:!0})]}),o.on("select",function(){var t=o.state().get("selection");t.map(function(t){t=t.toJSON(),t.id&&(n=n?n+","+t.id:t.id,a.append('					<li class="image" data-attachment_id="'+t.id+'">						<img src="'+t.url+'" />						<ul class="actions">							<li><a href="#" class="delete" title="'+r.data("delete")+'">'+r.data("text")+"</a></li>						</ul>					</li>"))}),e.val(n)}),void o.open())}),a.sortable({items:"li.image",cursor:"move",scrollSensitivity:40,forcePlaceholderSize:!0,forceHelperSize:!1,helper:"clone",opacity:.65,placeholder:"metabox-sortable-placeholder",start:function(t,o){o.item.css("background-color","#f6f6f6")},stop:function(t,o){o.item.removeAttr("style")},update:function(o,a){var i="";t("#portfolio_images_container ul li.image").css("cursor","default").each(function(){var o=t(this).attr("data-attachment_id");i=i+o+","}),e.val(i)}}),t("#portfolio_images_container").on("click","a.delete",function(){t(this).closest("li.image").remove();var o="";return t("#portfolio_images_container ul li.image").css("cursor","default").each(function(){var e=t(this).attr("data-attachment_id");o=o+e+","}),e.val(o),!1}),t(document).ready(function(){"1"==t("input.a3_portfolio_meta_layout_column:checked").val()?t(".portfolio_single_2_column_container").hide():t(".portfolio_single_2_column_container").show(),t(document).on("a3rev-ui-onoff_checkbox-switch",".a3_portfolio_meta_layout_column",function(o,e,a){"true"==a?t(".portfolio_single_2_column_container").hide():t(".portfolio_single_2_column_container").show()})}),t(document.body).on("a3-portfolio-enhanced-select-init",function(){t(":input.a3-portfolio-enhanced-select, :input.chosen_select").filter(":not(.enhanced)").each(function(){t(this).addClass("enhanced").chosen()})});var i=t(".portfolio_attributes").find(".portfolio_attribute").get();i.sort(function(o,e){var a=parseInt(t(o).attr("rel"),10),i=parseInt(t(e).attr("rel"),10);return i>a?-1:a>i?1:0}),t(i).each(function(o,e){t(".portfolio_attributes").append(e)}),t(".portfolio_attributes .portfolio_attribute").each(function(o,e){"none"!==t(e).css("display")&&t(e).is(".taxonomy")&&t("select.attribute_taxonomy").find('option[value="'+t(e).data("attribute-id")+'"]').prop("disabled",true)}),t("button.add_attribute").on("click",function(){var o=t("select.attribute_taxonomy").val();if(""==o)return window.alert(a3_portfolio_admin_meta_boxes.select_attribute_message),!1;var e=t(this).closest("#portfolio_attributes_panel"),a=e.find(".portfolio_attributes"),i={action:"a3_portfolio_add_attribute",attribute_id:parseInt(o),security:a3_portfolio_admin_meta_boxes.add_attribute_nonce};return e.block({message:null,overlayCSS:{background:"#fff",opacity:.6}}),t.post(a3_portfolio_admin_meta_boxes.ajax_url,i,function(o){a.append(o),t(document.body).trigger("a3-portfolio-enhanced-select-init"),e.unblock(),t(document.body).trigger("a3_portfolio_added_attribute")}),o&&(t("select.attribute_taxonomy").find('option[value="'+o+'"]').prop("disabled",true),t("select.attribute_taxonomy").val("")),!1}),t(".portfolio_attributes").on("click","button.select_all_attributes",function(){return t(this).closest("td").find("select option").prop("selected",true),t(this).closest("td").find("select").trigger("chosen:updated"),!1}),t(".portfolio_attributes").on("click","button.select_no_attributes",function(){return t(this).closest("td").find("select option").prop("selected",false),t(this).closest("td").find("select").trigger("chosen:updated"),!1}),t(".portfolio_attributes").on("click",".remove_row",function(){if(window.confirm(a3_portfolio_admin_meta_boxes.remove_attribute)){var o=t(this).parent().parent();o.remove(),t("select.attribute_taxonomy").find('option[value="'+o.data("attribute-id")+'"]').prop("disabled",false)}return!1}),t(".portfolio_attributes").sortable({items:".portfolio_attribute",cursor:"move",axis:"y",handle:"h3",scrollSensitivity:40,forcePlaceholderSize:!0,helper:"clone",opacity:.65,placeholder:"a3-metabox-item-sortable-placeholder",start:function(t,o){o.item.css("background-color","#f6f6f6")},stop:function(t,o){o.item.removeAttr("style")}}),t(".portfolio_attributes").on("click","button.add_new_attribute",function(){t(".portfolio_attributes").block({message:null,overlayCSS:{background:"#fff",opacity:.6}});var o=t(this).closest(".portfolio_attribute"),e=o.data("attribute-id"),a=window.prompt(a3_portfolio_admin_meta_boxes.new_attribute_prompt);if(a){var i={action:"a3_portfolio_add_new_attribute",attribute_id:e,term:a,security:a3_portfolio_admin_meta_boxes.add_attribute_nonce};t.post(a3_portfolio_admin_meta_boxes.ajax_url,i,function(e){e.error?window.alert(e.error):e.slug&&(o.find("select.attribute_values").append('<option value="'+e.slug+'" selected="selected">'+e.name+"</option>"),o.find("select.attribute_values").trigger("chosen:updated")),t(".portfolio_attributes").unblock()})}else t(".portfolio_attributes").unblock();return!1}),t(".save_attributes").on("click",function(){t("#a3_portfolio_data_meta_box").block({message:null,overlayCSS:{background:"#fff",opacity:.6}});var o={post_id:a3_portfolio_admin_meta_boxes.post_id,data:t(".portfolio_attributes").find("input, select, textarea").serialize(),action:"a3_portfolio_save_attributes",security:a3_portfolio_admin_meta_boxes.save_attributes_nonce};t.post(a3_portfolio_admin_meta_boxes.ajax_url,o,function(){t("#a3_portfolio_data_meta_box").unblock();var o=window.location.toString();o=o.replace("post-new.php?","post.php?post="+a3_portfolio_admin_meta_boxes.post_id+"&action=edit&")})})});